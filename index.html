<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>

    <button class="refresh">Refresh Tweets</button>
    <ul class = "feed">

    </ul>
    <script>

      var eachh = function(collection, iterator){
        if(Array.isArray(collection)){
          for(var i = 0; i<collection.length; i++){
            iterator(collection[i], i, collection);
          }
        } else {
          for(var prop in collection){
            if(collection.hasOwnProperty(prop)){
              iterator(collection[prop], prop, collection);
            }
          }
        }
      }

      $(document).ready(function(){
        var $body = $('body');
        // $body.html('');
        var index = streams.home.length - 1;
        var lastTime;

        // var createdAgo = function(){
        //   var date = new Date();
        //   var 
        // };

        // initial messages
        while(index >= 0){
          var tweet = streams.home[index];
          var $tweet = $('<div></div>');
          $tweet.text('@' + tweet.user + "-" + tweet.created_at + ': ' + tweet.message);
          $tweet.appendTo($(".feed"));
          index -= 1;
          lasTime = tweet.created_at;
        }
        // refresh button
        var msgCount = streams.home.length;
        $("button").on("click", function(){
          for(var x = msgCount; x<streams.home.length; x++){
            var tweet = streams.home[x];
            if(lastTime != tweet.created_at){
              var $tweet = $('<div></div>');
              $tweet.text('@' + tweet.user + "-" + tweet.created_at + ': ' + tweet.message);
              $tweet.prependTo($(".feed"));
              var date = new Date();
              console.log(tweet.created_at + " " + date);
              lastTime = tweet.created_at;
              msgCount += 1;
            }
          }
        });
        // auto-refresh
        // setInterval(function(){
        //   var tweet = streams.home[streams.home.length-1];
        //   if(lastTime != tweet.created_at){
        //     var $tweet = $('<div></div>');
        //     $tweet.text('@' + tweet.user + ': ' + tweet.message);
        //     $tweet.prependTo($(".feed"));
        //     lastTime = tweet.created_at;
        //     msgCount += 1;
        //   }
        // }, 500);

      });

    </script>
  </body>
</html>
